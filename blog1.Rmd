---
title: "Covid-19: Algeria"
description: "Policy Measures: Effective or ineffective"
date: "`r Sys.Date()`"
output:
  distill::distill_article:
    toc: true
    theme: theme.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(tidyverse)
library(knitr)
library(kableExtra)
library(rmarkdown)
library(DT)
library(sparkline)
library(lubridate)
```

```{r dataDownload}

covid_stats <- read_csv("data/owid-covid-data.csv")
measures <- readxl::read_excel("data/acaps_covid19_government_measures_dataset_0.xlsx",2)

```

```{r dataWrangling}

#Filter for Algeria
covid_stats_algeria <- covid_stats %>%
  filter(location == "Algeria") %>%
  select(date, new_cases, new_deaths)

measures_algeria <- measures %>%
  filter(COUNTRY == "Algeria") %>%
  select(MEASURE, COMMENTS, DATE_IMPLEMENTED, SOURCE, LINK)

covid_algeria <- full_join(covid_stats_algeria, measures_algeria, by = c("date" = "DATE_IMPLEMENTED"))
```

## Data Description

Data sets used in this report come from two main sources - 

1.    Collection of the COVID-19 data maintained by [Our World in Data](https://github.com/owid/covid-19-data/tree/master/public/data).
2.    [COVID-19 Government Measures Dataset](https://www.acaps.org/covid-19-government-measures-dataset) by ACAPS.

It contains a collection of data with `r length(covid_stats)` variables for COVID-19 dataset.
The data is available from `r covid_stats_algeria$date[1]` to `r covid_stats_algeria$date[550]` upon filtering for Algeria. The data sets are then filtered to select only the appropriate variables. Out of 62 variables in the COVID-19 dataset, only 5 were selected while 8 out of the 18 variables in the government measures dataset were selected. These tables are then merged together using the full join technique to get our final working dataset.

**Descriptions of variables**
```{r}

k <- data.frame(Variables = names(covid_algeria),
                Description = c("Date values",
                                "New cases recorded on date",
                                "New deaths recorded on date",
                                "Measures types and categories",
                                "Description of measure taken with further details",
                                "Source organization",
                                "Link to source website"))

paged_table(k, options = list(rows.print = 5, cols.print = 2))
  
```

## Numerical Summary Statistics

Two variables of the dataset **new_cases** and **new_deaths** show a large range of values that need to be analysed. The summary of their distribution statistics is visible in the table below -

**Summary Statistics**
```{r}
statistics <- data.frame(
  Variables = c("new_cases", "new_deaths"),
  Mean = c(mean(covid_algeria$new_cases, na.rm = TRUE),
                mean(covid_algeria$new_deaths, na.rm = TRUE)),
  SD = c(sd(covid_algeria$new_cases, na.rm = TRUE),
                  sd(covid_algeria$new_deaths, na.rm = TRUE)),
  `Maximum Value` = c(max(covid_algeria$new_cases, na.rm = TRUE),
                      max(covid_algeria$new_deaths, na.rm = TRUE))
  )
paged_table(statistics)
```

## Effect of Policy Measures on Prevention of New Covid-19 Cases

The below table gives 

```{r}

new_cases_range <- function(date2){
  test <- covid_algeria %>%
    filter(date >= as.Date(date2, origin = "1899-12-30") &
             date <= as.Date(date2, origin = "1899-12-30") + 14)
  return(test$new_cases)
}

new_deaths_range <- function(date2){
  test <- covid_algeria %>%
    filter(date >= as.Date(date2, origin = "1899-12-30") &
             date <= as.Date(date2, origin = "1899-12-30") + 14)
  return(test$new_deaths)
}

covid_measures <- covid_algeria[!is.na(covid_algeria$MEASURE),]
covid_measures <- covid_measures %>%
  mutate(Date = date(date))

covid_measures %>%
  select(Date, MEASURE) %>%
  rowwise() %>%
  mutate(cases_trend = spk_chr(new_cases_range(Date), type = "line", chartRangeMin=0, chartRangeMax=max(covid_algeria$new_cases)),
         death_trend = spk_chr(new_deaths_range(Date), type = "line", chartRangeMin=0, chartRangeMax=max(covid_algeria$new_cases))) %>%
  datatable(escape = FALSE,
            options = list(search = list(regex = TRUE),
                           scrollY = "300px",
                           scrollCollapse = TRUE,
                           paging = FALSE,
                           dom = "ft",
                           fnDrawCallback = htmlwidgets::JS(
  '
function(){
  HTMLWidgets.staticRender();
}
'
))) %>% 
  spk_add_deps()
  
  
```


## Citations

Hasell, J., Mathieu, E., Beltekian, D. et al. A cross-country database of COVID-19 testing. Sci Data 7, 345 (2020). https://doi.org/10.1038/s41597-020-00688-8

Covid-19 government measures dataset. ACAPS. (2020, December 10). https://www.acaps.org/covid-19-government-measures-dataset. 





